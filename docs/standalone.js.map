{"version":3,"file":"standalone.js","sources":["../apps/web/src/standalone.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { render } from 'react-dom';\r\nimport ArenaTag from './components/parts/ArenaTag';\r\nimport { PlayerInfo } from './arenaWorker';\r\nimport Arc from './components/core/Arc';\r\n\r\nimport * as Ace from 'brace';\r\nimport 'brace/mode/javascript';\r\nimport 'brace/theme/chrome';\r\n\r\nconst COLORS = ['#866', '#262', '#c55', '#44b'];\r\n\r\nconst attr = (element: HTMLElement, id: string) => element.getAttribute(id) || '';\r\n\r\nArray.prototype.forEach.call(document.getElementsByClassName('sourcer-standalone'), (element: HTMLElement) => {\r\n  const l = (id: string) => attr(element, id);\r\n  const width = parseInt(l('data-width'), 10) || -1;\r\n  const height = parseInt(l('data-height'), 10) || 384;\r\n  const scale = parseFloat(l('data-scale')) || 1.0;\r\n  const isDemo = element.hasAttribute('data-demo');\r\n  const playerIdsText = element.getAttribute('data-players');\r\n  if (playerIdsText) {\r\n    const players = playerIdsText\r\n      .split(',')\r\n      .map((value, index) => {\r\n        const playerElement = document.getElementById(value);\r\n        if (!playerElement) {\r\n          return null;\r\n        }\r\n        if (playerElement.tagName !== 'TEXTAREA') {\r\n          return { name: 'demo', color: COLORS[index], source: playerElement.innerText };\r\n        }\r\n        const playerTextArea = playerElement as HTMLTextAreaElement;\r\n        const playerInfo = { name: value, color: COLORS[index], source: playerTextArea.value } as PlayerInfo;\r\n        const polling = () => {\r\n          playerInfo.source = playerTextArea.value;\r\n          setTimeout(polling, 500);\r\n        };\r\n        polling();\r\n        return playerInfo;\r\n      })\r\n      .filter(playerInfo => playerInfo) as PlayerInfo[];\r\n\r\n    render(\r\n      <ArenaTag width={width} height={height} scale={scale} players={players} isDemo={isDemo} path=\"arenaWorker.js\" />,\r\n      element\r\n    );\r\n  }\r\n});\r\n\r\nArray.prototype.forEach.call(document.querySelectorAll('.arc'), (element: HTMLElement) => {\r\n  const l = (id: string) => attr(element, id);\r\n  const width = parseInt(l('width'), 10) || 160;\r\n  const height = parseInt(l('height'), 10) || 160;\r\n  const arrowDirection = parseInt(l('data-arrow'), 10) || 0;\r\n  const direction = -parseInt(l('data-direction'), 10);\r\n  const angle = parseInt(l('data-angle'), 10);\r\n  const renge = parseInt(l('data-distance'), 10);\r\n\r\n  const halfWidth = width / 2;\r\n  const halfHeight = height / 2;\r\n  const lines: JSX.Element[] = [];\r\n  let index = 0;\r\n  lines.push(<line key={index++} x1={0} y1={halfHeight} x2={0} y2={-halfHeight} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n  for (let i = 10; i < halfWidth; i += 10) {\r\n    lines.push(<line key={index++} x1={-i} y1={halfHeight} x2={-i} y2={-halfHeight} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n    lines.push(<line key={index++} x1={i} y1={halfHeight} x2={i} y2={-halfHeight} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n  }\r\n  lines.push(<line key={index++} x1={halfWidth} y1={0} x2={-halfWidth} y2={0} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n  for (let i = 10; i < halfHeight; i += 10) {\r\n    lines.push(<line key={index++} x1={halfWidth} y1={-i} x2={-halfWidth} y2={-i} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n    lines.push(<line key={index++} x1={halfWidth} y1={i} x2={-halfWidth} y2={i} strokeWidth=\"1\" stroke=\"#ddd\" />);\r\n  }\r\n\r\n  render(\r\n    <svg\r\n      transform={`scale(1, -1)`}\r\n      width={width}\r\n      height={height}\r\n      viewBox={`${-width / 2 + 0.5} ${-height / 2 + 0.5} ${width} ${height}`}\r\n    >\r\n      <rect x={-halfWidth} y={-halfHeight} height={height} width={width} fill=\"#eee\" />\r\n      {lines}\r\n      <Arc direction={direction} angle={angle} renge={renge} />\r\n      <path\r\n        transform={`rotate(${arrowDirection}, 0, 0)`}\r\n        d=\"M 10 0 L -10 6 L -4 0 L -10 -6 z\"\r\n        fill=\"#88f\"\r\n        stroke=\"#000\"\r\n        strokeWidth=\"1\"\r\n      />\r\n    </svg>,\r\n    element\r\n  );\r\n});\r\n\r\nconst preElements = document.querySelectorAll('pre.code');\r\nArray.prototype.forEach.call(preElements, (element: HTMLElement) => {\r\n  const editor = Ace.edit(element);\r\n  editor.setTheme('ace/theme/chrome');\r\n  editor.getSession().setMode('ace/mode/javascript');\r\n  editor.setOption('maxLines', 40);\r\n  editor.setReadOnly(true);\r\n});\r\n\r\nArray.prototype.forEach.call(document.querySelectorAll('textarea.code'), (element: HTMLTextAreaElement) => {\r\n  element.style.display = 'none';\r\n  const pre = document.createElement('pre');\r\n  pre.className = 'code';\r\n  const parent = element.parentNode;\r\n  if (parent) {\r\n    parent.insertBefore(pre, element);\r\n  }\r\n\r\n  setTimeout(() => {\r\n    pre.addEventListener('keydown', event => {\r\n      if (event.keyCode === 32) {\r\n        event.stopPropagation();\r\n      }\r\n    });\r\n    const editor = Ace.edit(pre);\r\n    editor.setTheme('ace/theme/chrome');\r\n    const session = editor.getSession();\r\n    session.setMode('ace/mode/javascript');\r\n    session.setTabSize(2);\r\n    editor.setOption('maxLines', 40);\r\n    editor.$blockScrolling = Infinity;\r\n    session.on('change', _e => {\r\n      element.value = editor.getValue();\r\n    });\r\n    editor.setValue(element.value);\r\n    editor.gotoLine(0);\r\n  });\r\n});\r\n"],"names":["COLORS","attr","element","id","l","width","height","scale","isDemo","playerIdsText","players","value","index","playerElement","playerTextArea","playerInfo","polling","render","React.createElement","ArenaTag","arrowDirection","direction","angle","renge","halfWidth","halfHeight","lines","i","Arc","preElements","editor","Ace.edit","pre","parent","event","session","_e"],"mappings":"iHAUA,MAAMA,EAAS,CAAC,OAAQ,OAAQ,OAAQ,MAAM,EAExCC,EAAO,CAACC,EAAsBC,IAAeD,EAAQ,aAAaC,CAAE,GAAK,GAE/E,MAAM,UAAU,QAAQ,KAAK,SAAS,uBAAuB,oBAAoB,EAAID,GAAyB,CAC5G,MAAME,EAAKD,GAAeF,EAAKC,EAASC,CAAE,EACpCE,EAAQ,SAASD,EAAE,YAAY,EAAG,EAAE,GAAK,GACzCE,EAAS,SAASF,EAAE,aAAa,EAAG,EAAE,GAAK,IAC3CG,EAAQ,WAAWH,EAAE,YAAY,CAAC,GAAK,EACvCI,EAASN,EAAQ,aAAa,WAAW,EACzCO,EAAgBP,EAAQ,aAAa,cAAc,EACzD,GAAIO,EAAe,CACjB,MAAMC,EAAUD,EACb,MAAM,GAAG,EACT,IAAI,CAACE,EAAOC,IAAU,CACrB,MAAMC,EAAgB,SAAS,eAAeF,CAAK,EACnD,GAAI,CAACE,EACH,OAAO,KAET,GAAIA,EAAc,UAAY,WAC5B,MAAO,CAAE,KAAM,OAAQ,MAAOb,EAAOY,CAAK,EAAG,OAAQC,EAAc,SAAA,EAErE,MAAMC,EAAiBD,EACjBE,EAAa,CAAE,KAAMJ,EAAO,MAAOX,EAAOY,CAAK,EAAG,OAAQE,EAAe,KAAA,EACzEE,EAAU,IAAM,CACpBD,EAAW,OAASD,EAAe,MACnC,WAAWE,EAAS,GAAG,CACzB,EACA,OAAAA,EAAA,EACOD,CACT,CAAC,EACA,OAAOA,GAAcA,CAAU,EAElCE,EAAAA,OACEC,gBAACC,GAAS,MAAAd,EAAc,OAAAC,EAAgB,MAAAC,EAAc,QAAAG,EAAkB,OAAAF,EAAgB,KAAK,iBAAiB,EAC9GN,CAAA,CAEJ,CACF,CAAC,EAED,MAAM,UAAU,QAAQ,KAAK,SAAS,iBAAiB,MAAM,EAAIA,GAAyB,CACxF,MAAME,EAAKD,GAAeF,EAAKC,EAASC,CAAE,EACpCE,EAAQ,SAASD,EAAE,OAAO,EAAG,EAAE,GAAK,IACpCE,EAAS,SAASF,EAAE,QAAQ,EAAG,EAAE,GAAK,IACtCgB,EAAiB,SAAShB,EAAE,YAAY,EAAG,EAAE,GAAK,EAClDiB,EAAY,CAAC,SAASjB,EAAE,gBAAgB,EAAG,EAAE,EAC7CkB,EAAQ,SAASlB,EAAE,YAAY,EAAG,EAAE,EACpCmB,EAAQ,SAASnB,EAAE,eAAe,EAAG,EAAE,EAEvCoB,EAAYnB,EAAQ,EACpBoB,EAAanB,EAAS,EACtBoB,EAAuB,CAAA,EAC7B,IAAId,EAAQ,EACZc,EAAM,KAAKR,EAAAA,cAAC,OAAA,CAAK,IAAKN,IAAS,GAAI,EAAG,GAAIa,EAAY,GAAI,EAAG,GAAI,CAACA,EAAY,YAAY,IAAI,OAAO,OAAO,CAAE,EAC9G,QAASE,EAAI,GAAIA,EAAIH,EAAWG,GAAK,GACnCD,EAAM,qBAAM,OAAA,CAAK,IAAKd,IAAS,GAAI,CAACe,EAAG,GAAIF,EAAY,GAAI,CAACE,EAAG,GAAI,CAACF,EAAY,YAAY,IAAI,OAAO,OAAO,CAAE,EAChHC,EAAM,KAAKR,EAAAA,cAAC,OAAA,CAAK,IAAKN,IAAS,GAAIe,EAAG,GAAIF,EAAY,GAAIE,EAAG,GAAI,CAACF,EAAY,YAAY,IAAI,OAAO,OAAO,CAAE,EAEhHC,EAAM,KAAKR,EAAAA,cAAC,OAAA,CAAK,IAAKN,IAAS,GAAIY,EAAW,GAAI,EAAG,GAAI,CAACA,EAAW,GAAI,EAAG,YAAY,IAAI,OAAO,OAAO,CAAE,EAC5G,QAASG,EAAI,GAAIA,EAAIF,EAAYE,GAAK,GACpCD,EAAM,qBAAM,OAAA,CAAK,IAAKd,IAAS,GAAIY,EAAW,GAAI,CAACG,EAAG,GAAI,CAACH,EAAW,GAAI,CAACG,EAAG,YAAY,IAAI,OAAO,OAAO,CAAE,EAC9GD,EAAM,KAAKR,EAAAA,cAAC,OAAA,CAAK,IAAKN,IAAS,GAAIY,EAAW,GAAIG,EAAG,GAAI,CAACH,EAAW,GAAIG,EAAG,YAAY,IAAI,OAAO,OAAO,CAAE,EAG9GV,EAAAA,OACEC,EAAAA,cAAC,MAAA,CACC,UAAW,eACX,MAAAb,EACA,OAAAC,EACA,QAAS,GAAG,CAACD,EAAQ,EAAI,EAAG,IAAI,CAACC,EAAS,EAAI,EAAG,IAAID,CAAK,IAAIC,CAAM,EAAA,EAEpEY,EAAAA,cAAC,OAAA,CAAK,EAAG,CAACM,EAAW,EAAG,CAACC,EAAY,OAAAnB,EAAgB,MAAAD,EAAc,KAAK,MAAA,CAAO,EAC9EqB,EACDR,EAAAA,cAACU,EAAA,CAAI,UAAAP,EAAsB,MAAAC,EAAc,MAAAC,CAAA,CAAc,EACvDL,EAAAA,cAAC,OAAA,CACC,UAAW,UAAUE,CAAc,UACnC,EAAE,mCACF,KAAK,OACL,OAAO,OACP,YAAY,GAAA,CAAA,CACd,EAEFlB,CAAA,CAEJ,CAAC,EAED,MAAM2B,EAAc,SAAS,iBAAiB,UAAU,EACxD,MAAM,UAAU,QAAQ,KAAKA,EAAc3B,GAAyB,CAClE,MAAM4B,EAASC,EAAAA,KAAS7B,CAAO,EAC/B4B,EAAO,SAAS,kBAAkB,EAClCA,EAAO,WAAA,EAAa,QAAQ,qBAAqB,EACjDA,EAAO,UAAU,WAAY,EAAE,EAC/BA,EAAO,YAAY,EAAI,CACzB,CAAC,EAED,MAAM,UAAU,QAAQ,KAAK,SAAS,iBAAiB,eAAe,EAAI5B,GAAiC,CACzGA,EAAQ,MAAM,QAAU,OACxB,MAAM8B,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,UAAY,OAChB,MAAMC,EAAS/B,EAAQ,WACnB+B,GACFA,EAAO,aAAaD,EAAK9B,CAAO,EAGlC,WAAW,IAAM,CACf8B,EAAI,iBAAiB,UAAWE,GAAS,CACnCA,EAAM,UAAY,IACpBA,EAAM,gBAAA,CAEV,CAAC,EACD,MAAMJ,EAASC,EAAAA,KAASC,CAAG,EAC3BF,EAAO,SAAS,kBAAkB,EAClC,MAAMK,EAAUL,EAAO,WAAA,EACvBK,EAAQ,QAAQ,qBAAqB,EACrCA,EAAQ,WAAW,CAAC,EACpBL,EAAO,UAAU,WAAY,EAAE,EAC/BA,EAAO,gBAAkB,IACzBK,EAAQ,GAAG,SAAUC,GAAM,CACzBlC,EAAQ,MAAQ4B,EAAO,SAAA,CACzB,CAAC,EACDA,EAAO,SAAS5B,EAAQ,KAAK,EAC7B4B,EAAO,SAAS,CAAC,CACnB,CAAC,CACH,CAAC"}