{"version":3,"file":"arenaWorker.js","sources":["../src/main/core/Actor.ts","../src/main/core/Command.ts","../src/main/core/SourcerCommand.ts","../src/main/core/Controller.ts","../src/main/core/FireParam.ts","../src/main/core/SourcerController.ts","../src/main/core/Consts.ts","../src/main/core/Fx.ts","../src/main/core/Shot.ts","../src/main/core/Laser.ts","../src/main/core/MissileCommand.ts","../src/main/core/MissileController.ts","../src/main/core/Missile.ts","../src/main/core/Sourcer.ts","../src/main/core/Field.ts","../src/main/core/ExposedScriptLoader.ts","../src/main/client/arenaWorker.ts"],"sourcesContent":["import Field from './Field';\r\nimport V from './V';\r\nimport Configs from './Configs';\r\nimport Shot from './Shot';\r\n\r\nexport default class Actor {\r\n  public id: number = -1;\r\n  public position: V;\r\n  public speed: V;\r\n  public direction: number = 0;\r\n  public size = Configs.COLLISION_SIZE;\r\n  public wait = 0;\r\n\r\n  constructor(public field: Field, x: number, y: number) {\r\n    this.wait = 0;\r\n    this.position = new V(x, y);\r\n    this.speed = new V(0, 0);\r\n  }\r\n\r\n  public think() {\r\n    if (this.wait <= 0) {\r\n      this.wait = 0;\r\n      this.onThink();\r\n    } else {\r\n      this.wait = this.wait - 1;\r\n    }\r\n  }\r\n\r\n  public onThink(): void {\r\n    // not think anything.\r\n  }\r\n\r\n  public action(): void {\r\n    // do nothing\r\n  }\r\n\r\n  public move() {\r\n    this.position = this.position.add(this.speed);\r\n  }\r\n\r\n  public onHit(_shot: Shot) {\r\n    // do nothing\r\n  }\r\n\r\n  public dump() {\r\n    throw new Error('not implimentation');\r\n  }\r\n}\r\n","export default class Command {\r\n  private isAccepted = false;\r\n  public validate() {\r\n    if (!this.isAccepted) {\r\n      throw new Error('Invalid command.');\r\n    }\r\n  }\r\n  public accept() {\r\n    this.isAccepted = true;\r\n  }\r\n  public unaccept() {\r\n    this.isAccepted = false;\r\n  }\r\n}\r\n","import Command from './Command';\r\nimport Sourcer from './Sourcer';\r\nimport Configs from './Configs';\r\nimport FireParam from './FireParam';\r\n\r\nexport default class SourcerCommand extends Command {\r\n  public ahead: number = 0;\r\n  public ascent: number = 0;\r\n  public turn: boolean = false;\r\n  public fire: FireParam | null = null;\r\n\r\n  constructor(public sourcer: Sourcer) {\r\n    super();\r\n    this.reset();\r\n  }\r\n\r\n  public reset() {\r\n    this.ahead = 0;\r\n    this.ascent = 0;\r\n    this.turn = false;\r\n    this.fire = null;\r\n  }\r\n\r\n  public execute() {\r\n    if (this.fire) {\r\n      this.sourcer.fire(this.fire);\r\n    }\r\n\r\n    if (this.turn) {\r\n      this.sourcer.direction *= -1;\r\n    }\r\n\r\n    if (0 < this.sourcer.fuel) {\r\n      this.sourcer.speed = this.sourcer.speed.add(this.ahead * this.sourcer.direction, this.ascent);\r\n      this.sourcer.fuel -= (Math.abs(this.ahead) + Math.abs(this.ascent)) * Configs.FUEL_COST;\r\n      this.sourcer.fuel = Math.max(0, this.sourcer.fuel);\r\n    }\r\n  }\r\n}\r\n","import Actor from './Actor';\r\n\r\nexport default class Controller {\r\n  public frame: () => number;\r\n  public altitude: () => number;\r\n  public wait: (frame: number) => void;\r\n\r\n  private framesOfLife: number = 0;\r\n  public preThink = () => {\r\n    this.framesOfLife++;\r\n  };\r\n\r\n  constructor(actor: Actor) {\r\n    this.frame = () => this.framesOfLife;\r\n    this.altitude = () => actor.position.y;\r\n    this.wait = (frame: number) => {\r\n      if (0 < frame) {\r\n        actor.wait += frame;\r\n      }\r\n    };\r\n  }\r\n}\r\n","import MissileController from './MissileController';\r\n\r\nexport default abstract class FireParam {\r\n  constructor(private shotType: string) {}\r\n  public isLaser(): this is LaserParam {\r\n    return this.shotType === 'Laser';\r\n  }\r\n  public isMissile(): this is MissileParam {\r\n    return this.shotType === 'Missile';\r\n  }\r\n}\r\n\r\nexport class MissileParam extends FireParam {\r\n  constructor(public bot: (controller: MissileController) => void) {\r\n    super('Missile');\r\n  }\r\n}\r\n\r\nexport class LaserParam extends FireParam {\r\n  constructor(power: number, public direction: number) {\r\n    super('Laser');\r\n    this.power = Math.min(Math.max(power || 8, 3), 8);\r\n  }\r\n  public power: number = 0;\r\n}\r\n","import Controller from './Controller';\r\nimport Sourcer from './Sourcer';\r\nimport Configs from './Configs';\r\nimport Utils from './Utils';\r\nimport MissileController from './MissileController';\r\nimport { ConsoleLike } from './ScriptLoader';\r\nimport { LaserParam, MissileParam } from './FireParam';\r\n\r\nexport default class SourcerController extends Controller {\r\n  public shield: () => number;\r\n  public temperature: () => number;\r\n  public missileAmmo: () => number;\r\n\r\n  public scanEnemy: (direction: number, angle: number, renge?: number) => boolean;\r\n  public scanAttack: (direction: number, angle: number, renge?: number) => boolean;\r\n\r\n  public ahead: () => void;\r\n  public back: () => void;\r\n  public ascent: () => void;\r\n  public descent: () => void;\r\n  public turn: () => void;\r\n\r\n  public fireLaser: (direction: number, power: number) => void;\r\n  public fireMissile: (bot: (controller: MissileController) => void) => void;\r\n\r\n  public fuel: () => number;\r\n\r\n  public log: (...messages: any[]) => void;\r\n  public scanDebug: (direction: number, angle: number, renge?: number) => void;\r\n\r\n  constructor(sourcer: Sourcer) {\r\n    super(sourcer);\r\n\r\n    this.shield = () => sourcer.shield;\r\n    this.temperature = () => sourcer.temperature;\r\n    this.missileAmmo = () => sourcer.missileAmmo;\r\n    this.fuel = () => sourcer.fuel;\r\n\r\n    const field = sourcer.field;\r\n    const command = sourcer.command;\r\n    this.scanEnemy = (direction, angle, renge) => {\r\n      command.validate();\r\n      sourcer.wait += Configs.SCAN_WAIT;\r\n      const oppositedDirection = sourcer.opposite(direction);\r\n      const normalizedRenge = renge || Number.MAX_VALUE;\r\n      const radar = Utils.createRadar(sourcer.position, oppositedDirection, angle, normalizedRenge);\r\n      return field.scanEnemy(sourcer, radar);\r\n    };\r\n    this.scanAttack = (direction, angle, renge) => {\r\n      command.validate();\r\n      sourcer.wait += Configs.SCAN_WAIT;\r\n      const oppositedDirection = sourcer.opposite(direction);\r\n      const normalizedRenge = renge || Number.MAX_VALUE;\r\n      const radar = Utils.createRadar(sourcer.position, oppositedDirection, angle, normalizedRenge);\r\n      return field.scanAttack(sourcer, radar);\r\n    };\r\n    this.ahead = () => {\r\n      command.validate();\r\n      command.ahead = 0.8;\r\n    };\r\n    this.back = () => {\r\n      command.validate();\r\n      command.ahead = -0.4;\r\n    };\r\n    this.ascent = () => {\r\n      command.validate();\r\n      command.ascent = 0.9;\r\n    };\r\n    this.descent = () => {\r\n      command.validate();\r\n      command.ascent = -0.9;\r\n    };\r\n    this.turn = () => {\r\n      command.validate();\r\n      command.turn = true;\r\n    };\r\n\r\n    this.fireLaser = (direction, power) => {\r\n      command.validate();\r\n      command.fire = new LaserParam(power, direction);\r\n    };\r\n\r\n    this.fireMissile = bot => {\r\n      command.validate();\r\n      command.fire = new MissileParam(bot);\r\n    };\r\n\r\n    const isString = (value: any): value is string => Object.prototype.toString.call(value) === '[object String]';\r\n    this.log = (...message: any[]) => {\r\n      command.validate();\r\n      sourcer.log(message.map(value => (isString(value) ? value : JSON.stringify(value))).join(', '));\r\n    };\r\n    this.scanDebug = (direction, angle, renge) => {\r\n      command.validate();\r\n      sourcer.scanDebug(sourcer.opposite(direction), angle, renge);\r\n    };\r\n  }\r\n\r\n  public connectConsole(console: ConsoleLike | null) {\r\n    if (console) {\r\n      console.log = this.log.bind(this);\r\n    }\r\n  }\r\n}\r\n","export default class Consts {\r\n  public static DIRECTION_RIGHT = 1;\r\n  public static DIRECTION_LEFT = -1;\r\n  public static VERTICAL_UP = 'vertial_up';\r\n  public static VERTICAL_DOWN = 'vertial_down';\r\n}\r\n","import Field from './Field';\r\nimport V from './V';\r\nimport { FxDump } from './Dump';\r\n\r\nexport default class Fx {\r\n  private frame: number;\r\n  public id: number = -1;\r\n\r\n  constructor(public field: Field, public position: V, public speed: V, public length: number) {\r\n    this.frame = 0;\r\n  }\r\n\r\n  public action() {\r\n    this.frame++;\r\n    if (this.length <= this.frame) {\r\n      this.field.removeFx(this);\r\n    }\r\n  }\r\n\r\n  public move() {\r\n    this.position = this.position.add(this.speed);\r\n  }\r\n\r\n  public dump(): FxDump {\r\n    return {\r\n      i: this.id,\r\n      p: this.position.minimize(),\r\n      f: this.frame,\r\n      l: Math.round(this.length)\r\n    };\r\n  }\r\n}\r\n","import Field from './Field';\r\nimport Sourcer from './Sourcer';\r\nimport Actor from './Actor';\r\nimport Fx from './Fx';\r\nimport { ShotDump } from './Dump';\r\nimport V from './V';\r\nimport Utils from './Utils';\r\n\r\nexport default class Shot extends Actor {\r\n  public temperature = 0;\r\n  public damage = () => 0;\r\n  public breakable = false;\r\n\r\n  constructor(field: Field, public owner: Sourcer, public type: string) {\r\n    super(field, owner.position.x, owner.position.y);\r\n  }\r\n\r\n  public action() {\r\n    this.onAction();\r\n\r\n    const collided = this.field.checkCollision(this);\r\n    if (collided) {\r\n      collided.onHit(this);\r\n      this.createFxs();\r\n    }\r\n\r\n    if (this.field.checkCollisionEnviroment(this)) {\r\n      this.field.removeShot(this);\r\n      this.createFxs();\r\n    }\r\n  }\r\n\r\n  private createFxs() {\r\n    for (let i = 0; i < 3; i++) {\r\n      const position = this.position.add(Utils.rand(16) - 8, Utils.rand(16) - 8);\r\n      const speed = new V(Utils.rand(1) - 0.5, Utils.rand(1) - 0.5);\r\n      const length = Utils.rand(8) + 4;\r\n      this.field.addFx(new Fx(this.field, position, this.speed.divide(2).add(speed), length));\r\n    }\r\n  }\r\n\r\n  public reaction(sourcer: Sourcer) {\r\n    sourcer.temperature += this.temperature;\r\n  }\r\n\r\n  public onAction() {\r\n    // do nothing\r\n  }\r\n\r\n  public dump(): ShotDump {\r\n    return {\r\n      o: this.owner.id,\r\n      i: this.id,\r\n      p: this.position.minimize(),\r\n      d: this.direction,\r\n      s: this.type\r\n    };\r\n  }\r\n}\r\n","import Shot from './Shot';\r\nimport Field from './Field';\r\nimport Sourcer from './Sourcer';\r\nimport V from './V';\r\nimport Configs from './Configs';\r\n\r\nexport default class Laser extends Shot {\r\n  public temperature = 5;\r\n  public damage = () => 8;\r\n  private momentum: number;\r\n  constructor(field: Field, owner: Sourcer, public direction: number, power: number) {\r\n    super(field, owner, 'Laser');\r\n    this.speed = V.direction(direction).multiply(power);\r\n    this.momentum = Configs.LASER_MOMENTUM;\r\n  }\r\n\r\n  public action() {\r\n    super.action();\r\n    this.momentum -= Configs.LASER_ATTENUATION;\r\n    if (this.momentum < 0) {\r\n      this.field.removeShot(this);\r\n    }\r\n  }\r\n}\r\n","import Command from './Command';\r\nimport Missile from './Missile';\r\nimport Configs from './Configs';\r\nimport V from './V';\r\n\r\nexport default class MissileCommand extends Command {\r\n  public speedUp: number = 0;\r\n  public speedDown: number = 0;\r\n  public turn: number = 0;\r\n\r\n  constructor(public missile: Missile) {\r\n    super();\r\n    this.reset();\r\n  }\r\n\r\n  public reset() {\r\n    this.speedUp = 0;\r\n    this.speedDown = 0;\r\n    this.turn = 0;\r\n  }\r\n\r\n  public execute() {\r\n    if (0 < this.missile.fuel) {\r\n      this.missile.direction += this.turn;\r\n      const normalized = V.direction(this.missile.direction);\r\n      this.missile.speed = this.missile.speed.add(normalized.multiply(this.speedUp));\r\n      this.missile.speed = this.missile.speed.multiply(1 - this.speedDown);\r\n      this.missile.fuel -= (this.speedUp + this.speedDown * 3) * Configs.FUEL_COST;\r\n      this.missile.fuel = Math.max(0, this.missile.fuel);\r\n    }\r\n  }\r\n}\r\n","import Controller from './Controller';\r\nimport Missile from './Missile';\r\nimport Utils from './Utils';\r\nimport { ConsoleLike } from './ScriptLoader';\r\n\r\nexport default class MissileController extends Controller {\r\n  public direction: () => number;\r\n  public scanEnemy: (direction: number, angle: number, renge?: number) => boolean;\r\n  public speedUp: () => void;\r\n  public speedDown: () => void;\r\n  public turnRight: () => void;\r\n  public turnLeft: () => void;\r\n  public fuel: () => number;\r\n\r\n  public log: (...messages: any[]) => void;\r\n  public scanDebug: (direction: number, angle: number, renge?: number) => void;\r\n\r\n  constructor(missile: Missile) {\r\n    super(missile);\r\n    this.direction = () => missile.direction;\r\n\r\n    const command = missile.command;\r\n\r\n    this.fuel = () => missile.fuel;\r\n\r\n    this.scanEnemy = (direction, angle, renge) => {\r\n      command.validate();\r\n      missile.wait += 1.5;\r\n      const missileDirection = missile.opposite(direction);\r\n      const radar = Utils.createRadar(missile.position, missileDirection, angle, renge || Number.MAX_VALUE);\r\n      return missile.field.scanEnemy(missile.owner, radar);\r\n    };\r\n\r\n    this.speedUp = () => {\r\n      command.validate();\r\n      command.speedUp = 0.8;\r\n    };\r\n\r\n    this.speedDown = () => {\r\n      command.validate();\r\n      command.speedDown = 0.1;\r\n    };\r\n\r\n    this.turnRight = () => {\r\n      command.validate();\r\n      command.turn = -9;\r\n    };\r\n\r\n    this.turnLeft = () => {\r\n      command.validate();\r\n      command.turn = 9;\r\n    };\r\n    const isString = (value: any): value is string => Object.prototype.toString.call(value) === '[object String]';\r\n    this.log = (...message: any[]) => {\r\n      command.validate();\r\n      missile.log(message.map(value => (isString(value) ? value : JSON.stringify(value))).join(', '));\r\n    };\r\n    this.scanDebug = (direction, angle, renge) => {\r\n      command.validate();\r\n      missile.scanDebug(missile.opposite(direction), angle, renge);\r\n    };\r\n  }\r\n\r\n  public connectConsole(console: ConsoleLike | null) {\r\n    if (console) {\r\n      console.log = this.log.bind(this);\r\n    }\r\n  }\r\n}\r\n","import Shot from './Shot';\r\nimport Field from './Field';\r\nimport Sourcer from './Sourcer';\r\nimport Configs from './Configs';\r\nimport MissileCommand from './MissileCommand';\r\nimport MissileController from './MissileController';\r\nimport Consts from './Consts';\r\nimport { DebugDump, ShotDump } from './Dump';\r\n\r\nexport default class Missile extends Shot {\r\n  public temperature = 10;\r\n  public damage = () => 10 + this.speed.length() * 2;\r\n  public fuel = 100;\r\n  public breakable = true;\r\n\r\n  public command: MissileCommand;\r\n  public controller: MissileController;\r\n  private debugDump: DebugDump = { logs: [], arcs: [] };\r\n\r\n  constructor(field: Field, owner: Sourcer, public bot: (controller: MissileController) => void) {\r\n    super(field, owner, 'Missile');\r\n    this.direction = owner.direction === Consts.DIRECTION_RIGHT ? 0 : 180;\r\n    this.speed = owner.speed;\r\n    this.command = new MissileCommand(this);\r\n    this.command.reset();\r\n    this.controller = new MissileController(this);\r\n  }\r\n\r\n  public onThink() {\r\n    this.command.reset();\r\n\r\n    if (this.fuel <= 0) {\r\n      // Cancel thinking\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.command.accept();\r\n      this.controller.preThink();\r\n      this.debugDump = { logs: [], arcs: [] };\r\n      if (this.owner.scriptLoader) {\r\n        this.controller.connectConsole(this.owner.scriptLoader.getExposedConsole());\r\n      }\r\n      this.bot(this.controller);\r\n    } catch (error) {\r\n      this.command.reset();\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      this.debugDump.logs.push({ message: `Missile function error: ${message}`, color: 'red' });\r\n    } finally {\r\n      this.command.unaccept();\r\n    }\r\n  }\r\n\r\n  public onAction() {\r\n    this.speed = this.speed.multiply(Configs.SPEED_RESISTANCE);\r\n    this.command.execute();\r\n    this.command.reset();\r\n  }\r\n\r\n  public onHit(attack: Shot) {\r\n    this.field.removeShot(this);\r\n    this.field.removeShot(attack);\r\n  }\r\n\r\n  public opposite(direction: number): number {\r\n    return this.direction + direction;\r\n  }\r\n\r\n  public log(message: string) {\r\n    this.debugDump.logs.push({ message });\r\n  }\r\n\r\n  public scanDebug(direction: number, angle: number, renge?: number) {\r\n    this.debugDump.arcs.push({ direction, angle, renge });\r\n  }\r\n\r\n  public dump(): ShotDump {\r\n    const superDump = super.dump();\r\n    if (this.owner.scriptLoader && this.owner.scriptLoader.isDebuggable()) {\r\n      superDump.debug = this.debugDump;\r\n    }\r\n    return superDump;\r\n  }\r\n}\r\n","import Actor from './Actor';\r\nimport Field from './Field';\r\nimport SourcerCommand from './SourcerCommand';\r\nimport SourcerController from './SourcerController';\r\nimport FireParam from './FireParam';\r\nimport Configs from './Configs';\r\nimport Consts from './Consts';\r\nimport Utils from './Utils';\r\nimport V from './V';\r\nimport Shot from './Shot';\r\nimport Laser from './Laser';\r\nimport Missile from './Missile';\r\nimport { SourcerDump, DebugDump } from './Dump';\r\nimport Fx from './Fx';\r\nimport ScriptLoader from './ScriptLoader';\r\n\r\nexport default class Sourcer extends Actor {\r\n  public alive = true;\r\n  public temperature = 0;\r\n  public shield = Configs.INITIAL_SHIELD;\r\n  public missileAmmo = Configs.INITIAL_MISSILE_AMMO;\r\n  public fuel = Configs.INITIAL_FUEL;\r\n\r\n  public command: SourcerCommand;\r\n  public scriptLoader?: ScriptLoader;\r\n  private controller: SourcerController;\r\n  private bot: ((controller: SourcerController) => void) | null = null;\r\n  private debugDump: DebugDump = { logs: [], arcs: [] };\r\n\r\n  constructor(\r\n    field: Field,\r\n    x: number,\r\n    y: number,\r\n    public aiSource: string,\r\n    public account: string,\r\n    public name: string,\r\n    public color: string\r\n  ) {\r\n    super(field, x, y);\r\n\r\n    this.direction = Math.random() < 0.5 ? Consts.DIRECTION_RIGHT : Consts.DIRECTION_LEFT;\r\n    this.command = new SourcerCommand(this);\r\n    this.controller = new SourcerController(this);\r\n  }\r\n\r\n  public compile(scriptLoader: ScriptLoader) {\r\n    this.scriptLoader = scriptLoader;\r\n    this.bot = scriptLoader.load(this.aiSource);\r\n    if (!this.bot) {\r\n      throw { message: 'Function has not been returned.' };\r\n    }\r\n    if (typeof this.bot !== 'function') {\r\n      throw { message: 'Returned is not a Function.' };\r\n    }\r\n  }\r\n\r\n  public onThink() {\r\n    if (this.bot === null || !this.alive) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.command.accept();\r\n      this.controller.preThink();\r\n      this.debugDump = { logs: [], arcs: [] };\r\n      if (this.scriptLoader) {\r\n        this.controller.connectConsole(this.scriptLoader.getExposedConsole());\r\n      }\r\n      this.bot(this.controller);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      this.debugDump.logs.push({ message: `Sourcer function error: ${message}`, color: 'red' });\r\n      this.command.reset();\r\n    } finally {\r\n      this.command.unaccept();\r\n    }\r\n  }\r\n\r\n  public action() {\r\n    if (!this.alive && Utils.rand(8) < 1) {\r\n      const position = this.position.add(Utils.rand(16) - 8, Utils.rand(16) - 8);\r\n      const speed = new V(Utils.rand(1) - 0.5, Utils.rand(1) + 0.5);\r\n      const length = Utils.rand(8) + 4;\r\n      this.field.addFx(new Fx(this.field, position, speed, length));\r\n    }\r\n\r\n    // air resistance\r\n    this.speed = this.speed.multiply(Configs.SPEED_RESISTANCE);\r\n\r\n    // gravity\r\n    this.speed = this.speed.subtract(0, Configs.GRAVITY);\r\n\r\n    // control altitude by the invisible hand\r\n    if (Configs.TOP_INVISIBLE_HAND < this.position.y) {\r\n      const invisiblePower = (this.position.y - Configs.TOP_INVISIBLE_HAND) * 0.1;\r\n      this.speed = this.speed.subtract(0, Configs.GRAVITY * invisiblePower);\r\n    }\r\n\r\n    // control distance by the invisible hand\r\n    const diff = this.field.center - this.position.x;\r\n    if (Configs.DISTANCE_BORDAR < Math.abs(diff)) {\r\n      const n = diff < 0 ? -1 : 1;\r\n      const invisibleHand = (Math.abs(diff) - Configs.DISTANCE_BORDAR) * Configs.DISTANCE_INVISIBLE_HAND * n;\r\n      this.position = new V(this.position.x + invisibleHand, this.position.y);\r\n    }\r\n\r\n    // go into the ground\r\n    if (this.position.y < 0) {\r\n      this.shield -= -this.speed.y * Configs.GROUND_DAMAGE_SCALE;\r\n      this.position = new V(this.position.x, 0);\r\n      this.speed = new V(this.speed.x, 0);\r\n    }\r\n\r\n    this.temperature -= Configs.COOL_DOWN;\r\n    this.temperature = Math.max(this.temperature, 0);\r\n\r\n    // overheat\r\n    const overheat = this.temperature - Configs.OVERHEAT_BORDER;\r\n    if (0 < overheat) {\r\n      const linearDamage = overheat * Configs.OVERHEAT_DAMAGE_LINEAR_WEIGHT;\r\n      const powerDamage = Math.pow(overheat * Configs.OVERHEAT_DAMAGE_POWER_WEIGHT, 2);\r\n      this.shield -= linearDamage + powerDamage;\r\n    }\r\n    this.shield = Math.max(0, this.shield);\r\n\r\n    this.command.execute();\r\n    this.command.reset();\r\n  }\r\n\r\n  public fire(param: FireParam) {\r\n    if (param.isLaser()) {\r\n      const direction = this.opposite(param.direction);\r\n      const shot = new Laser(this.field, this, direction, param.power);\r\n      shot.reaction(this);\r\n      this.field.addShot(shot);\r\n    }\r\n\r\n    if (param.isMissile()) {\r\n      if (0 < this.missileAmmo) {\r\n        const missile = new Missile(this.field, this, param.bot);\r\n        missile.reaction(this);\r\n        this.missileAmmo--;\r\n        this.field.addShot(missile);\r\n      }\r\n    }\r\n  }\r\n\r\n  public opposite(direction: number): number {\r\n    if (this.direction === Consts.DIRECTION_LEFT) {\r\n      return Utils.toOpposite(direction);\r\n    }\r\n    return direction;\r\n  }\r\n\r\n  public onHit(shot: Shot) {\r\n    this.speed = this.speed.add(shot.speed.multiply(Configs.ON_HIT_SPEED_GIVEN_RATE));\r\n    this.shield -= shot.damage();\r\n    this.shield = Math.max(0, this.shield);\r\n    this.field.removeShot(shot);\r\n  }\r\n\r\n  public log(message: string) {\r\n    this.debugDump.logs.push({ message });\r\n  }\r\n\r\n  public scanDebug(direction: number, angle: number, renge?: number) {\r\n    this.debugDump.arcs.push({ direction, angle, renge });\r\n  }\r\n\r\n  public dump(): SourcerDump {\r\n    const dump: SourcerDump = {\r\n      i: this.id,\r\n      p: this.position.minimize(),\r\n      d: this.direction,\r\n      h: Math.ceil(this.shield),\r\n      t: Math.ceil(this.temperature),\r\n      a: this.missileAmmo,\r\n      f: Math.ceil(this.fuel)\r\n    };\r\n    if (this.scriptLoader && this.scriptLoader.isDebuggable()) {\r\n      dump.debug = this.debugDump;\r\n    }\r\n    return dump;\r\n  }\r\n}\r\n","import V from './V';\r\nimport Actor from './Actor';\r\nimport Sourcer from './Sourcer';\r\nimport Shot from './Shot';\r\nimport Fx from './Fx';\r\nimport Utils from './Utils';\r\nimport TickEventListener from './TickEventListener';\r\nimport { FrameDump, ResultDump, SourcerDump, ShotDump, FxDump, PlayersDump } from './Dump';\r\nimport { ScriptLoaderConstructor } from './ScriptLoader';\r\n\r\nconst DEMO_FRAME_LENGTH = 128;\r\n\r\nexport default class Field {\r\n  private currentId = 0;\r\n  private sourcers: Sourcer[];\r\n  private shots: Shot[];\r\n  private fxs: Fx[];\r\n  private frame: number;\r\n  private result?: ResultDump;\r\n  public center: number = 0;\r\n  public isFinished: boolean = false;\r\n\r\n  private dummyEnemy: V = new V(0, 150);\r\n\r\n  constructor(private scriptLoaderConstructor: ScriptLoaderConstructor, public isDemo: boolean = false) {\r\n    this.frame = 0;\r\n    this.sourcers = [];\r\n    this.shots = [];\r\n    this.fxs = [];\r\n  }\r\n\r\n  public registerSourcer(source: string, account: string, name: string, color: string) {\r\n    const side = this.sourcers.length % 2 === 0 ? -1 : 1;\r\n    const x = Utils.rand(80) + 160 * side;\r\n    const y = Utils.rand(160) + 80;\r\n    this.addSourcer(new Sourcer(this, x, y, source, account, name, color));\r\n  }\r\n\r\n  public async process(listener: TickEventListener, think: (sourcer: Sourcer) => void) {\r\n    for (const sourcer of this.sourcers) {\r\n      listener.onPreThink(sourcer.id);\r\n      await listener.waitNextTick();\r\n      think(sourcer);\r\n      listener.onPostThink(sourcer.id);\r\n      await listener.waitNextTick();\r\n    }\r\n  }\r\n\r\n  public async compile(listener: TickEventListener) {\r\n    return this.process(listener, (sourcer: Sourcer) => {\r\n      try {\r\n        sourcer.compile(new this.scriptLoaderConstructor());\r\n      } catch (error) {\r\n        const message = error instanceof Error ? error.message : String(error);\r\n\r\n        listener.onError(`There is an error in your code: ${message}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  public addSourcer(sourcer: Sourcer) {\r\n    sourcer.id = this.currentId++;\r\n    this.sourcers.push(sourcer);\r\n  }\r\n\r\n  public addShot(shot: Shot) {\r\n    shot.id = this.currentId++;\r\n    this.shots.push(shot);\r\n  }\r\n\r\n  public removeShot(target: Shot) {\r\n    const index = this.shots.indexOf(target);\r\n    if (0 <= index) {\r\n      this.shots.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public addFx(fx: Fx) {\r\n    fx.id = this.currentId++;\r\n    this.fxs.push(fx);\r\n  }\r\n\r\n  public removeFx(target: Fx) {\r\n    const index = this.fxs.indexOf(target);\r\n    if (0 <= index) {\r\n      this.fxs.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public async tick(listener: TickEventListener) {\r\n    if (this.frame === 0) {\r\n      listener.onFrame(this.dump()); // Save the 0 frame.\r\n    }\r\n\r\n    // To be used in the invisible hand.\r\n    this.center = this.computeCenter();\r\n\r\n    // Think phase\r\n    await this.process(listener, (sourcer: Sourcer) => {\r\n      sourcer.think();\r\n      this.shots.filter(shot => shot.owner.id === sourcer.id).forEach(shot => shot.think());\r\n    });\r\n\r\n    // Action phase\r\n    this.sourcers.forEach(actor => actor.action());\r\n    this.shots.forEach(actor => actor.action());\r\n    this.fxs.forEach(actor => actor.action());\r\n\r\n    // Move phase\r\n    this.sourcers.forEach(actor => actor.move());\r\n    this.shots.forEach(actor => actor.move());\r\n    this.fxs.forEach(actor => actor.move());\r\n\r\n    // Check phase\r\n    this.checkFinish(listener);\r\n    this.checkEndOfGame(listener);\r\n\r\n    this.frame++;\r\n\r\n    // onFrame\r\n    listener.onFrame(this.dump());\r\n  }\r\n\r\n  private checkFinish(listener: TickEventListener) {\r\n    if (this.isDemo) {\r\n      if (DEMO_FRAME_LENGTH < this.frame) {\r\n        this.result = {\r\n          frame: this.frame,\r\n          timeout: null,\r\n          isDraw: null,\r\n          winnerId: null\r\n        };\r\n        listener.onFinished(this.result);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.result) {\r\n      return;\r\n    }\r\n\r\n    this.sourcers.forEach(sourcer => {\r\n      sourcer.alive = 0 < sourcer.shield;\r\n    });\r\n    const survivers = this.sourcers.filter(sourcer => sourcer.alive);\r\n\r\n    if (1 < survivers.length) {\r\n      return;\r\n    }\r\n\r\n    if (survivers.length === 1) {\r\n      const surviver = survivers[0];\r\n      this.result = {\r\n        winnerId: surviver.id,\r\n        frame: this.frame,\r\n        timeout: null,\r\n        isDraw: false\r\n      };\r\n      listener.onFinished(this.result);\r\n      return;\r\n    }\r\n\r\n    // no surviver.. draw...\r\n    this.result = {\r\n      winnerId: null,\r\n      timeout: null,\r\n      frame: this.frame,\r\n      isDraw: true\r\n    };\r\n    listener.onFinished(this.result);\r\n  }\r\n\r\n  private checkEndOfGame(listener: TickEventListener) {\r\n    if (this.isFinished) {\r\n      return;\r\n    }\r\n\r\n    if (!this.result) {\r\n      return;\r\n    }\r\n\r\n    if (this.isDemo) {\r\n      this.isFinished = true;\r\n      listener.onEndOfGame();\r\n      return;\r\n    }\r\n\r\n    if (this.result.frame < this.frame - 90) {\r\n      // Record some frames even after decided.\r\n      this.isFinished = true;\r\n      listener.onEndOfGame();\r\n    }\r\n  }\r\n\r\n  public scanEnemy(owner: Sourcer, radar: (t: V) => boolean): boolean {\r\n    if (this.isDemo && this.sourcers.length === 1) {\r\n      return radar(this.dummyEnemy);\r\n    }\r\n\r\n    return this.sourcers.some(sourcer => {\r\n      return sourcer.alive && sourcer !== owner && radar(sourcer.position);\r\n    });\r\n  }\r\n\r\n  public scanAttack(owner: Sourcer, radar: (t: V) => boolean): boolean {\r\n    return this.shots.some(shot => {\r\n      return shot.owner !== owner && radar(shot.position) && this.isIncoming(owner, shot);\r\n    });\r\n  }\r\n\r\n  private isIncoming(owner: Sourcer, shot: Shot) {\r\n    const ownerPosition = owner.position;\r\n    const actorPosition = shot.position;\r\n    const currentDistance = ownerPosition.distance(actorPosition);\r\n    const nextDistance = ownerPosition.distance(actorPosition.add(shot.speed));\r\n    return nextDistance < currentDistance;\r\n  }\r\n\r\n  public checkCollision(shot: Shot): Actor | null {\r\n    const f = shot.position;\r\n    const t = shot.position.add(shot.speed);\r\n\r\n    const collidedShot = this.shots.find(actor => {\r\n      return (\r\n        actor.breakable &&\r\n        actor.owner !== shot.owner &&\r\n        Utils.calcDistance(f, t, actor.position) < shot.size + actor.size\r\n      );\r\n    });\r\n    if (collidedShot) {\r\n      return collidedShot;\r\n    }\r\n\r\n    const collidedSourcer = this.sourcers.find(sourcer => {\r\n      return (\r\n        sourcer.alive && sourcer !== shot.owner && Utils.calcDistance(f, t, sourcer.position) < shot.size + sourcer.size\r\n      );\r\n    });\r\n    if (collidedSourcer) {\r\n      return collidedSourcer;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public checkCollisionEnviroment(shot: Shot): boolean {\r\n    return shot.position.y < 0;\r\n  }\r\n\r\n  private computeCenter(): number {\r\n    let count = 0;\r\n    let sumX = 0;\r\n    this.sourcers.forEach((sourcer: Sourcer) => {\r\n      if (sourcer.alive) {\r\n        sumX += sourcer.position.x;\r\n        count++;\r\n      }\r\n    });\r\n    return sumX / count;\r\n  }\r\n\r\n  public players() {\r\n    const players: PlayersDump = {};\r\n    this.sourcers.forEach(sourcer => {\r\n      players[sourcer.id] = {\r\n        name: sourcer.name || sourcer.account,\r\n        account: sourcer.account,\r\n        color: sourcer.color\r\n      };\r\n    });\r\n    return players;\r\n  }\r\n\r\n  private dump(): FrameDump {\r\n    const sourcersDump: SourcerDump[] = [];\r\n    const shotsDump: ShotDump[] = [];\r\n    const fxDump: FxDump[] = [];\r\n\r\n    this.sourcers.forEach(actor => {\r\n      sourcersDump.push(actor.dump());\r\n    });\r\n\r\n    this.shots.forEach(actor => {\r\n      shotsDump.push(actor.dump());\r\n    });\r\n    this.fxs.forEach(fx => {\r\n      fxDump.push(fx.dump());\r\n    });\r\n\r\n    return {\r\n      f: this.frame,\r\n      s: sourcersDump,\r\n      b: shotsDump,\r\n      x: fxDump\r\n    };\r\n  }\r\n}\r\n","import ScriptLoader, { ConsoleLike } from './ScriptLoader';\r\n\r\nfunction construct(constructor: any, args: string[]) {\r\n  function fun(this: any) {\r\n    return constructor.apply(this, args);\r\n  }\r\n  fun.prototype = constructor.prototype;\r\n  return new (fun as any)();\r\n}\r\n\r\nexport default class ExposedScriptLoader implements ScriptLoader {\r\n  private argValues: any[];\r\n  private argNames: string[];\r\n  private console: ConsoleLike;\r\n\r\n  constructor() {\r\n    this.console = {\r\n      log: (..._message) => {\r\n        /* nothing.. */\r\n      }\r\n    };\r\n    const allowLibs = {\r\n      Object,\r\n      String,\r\n      Number,\r\n      Boolean,\r\n      Array,\r\n      Date,\r\n      Math,\r\n      RegExp,\r\n      JSON,\r\n      NaN,\r\n      Infinity,\r\n      undefined,\r\n      parseInt,\r\n      parseFloat,\r\n      isNaN,\r\n      isFinite,\r\n      console: this.console\r\n    };\r\n\r\n    this.argNames = Object.keys(allowLibs);\r\n    this.argValues = this.argNames.map(key => (allowLibs as any)[key]);\r\n  }\r\n\r\n  public isDebuggable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  public getExposedConsole(): ConsoleLike | null {\r\n    return this.console;\r\n  }\r\n\r\n  public load(script: string): any {\r\n    let argNames: string[] = [];\r\n    argNames = argNames.concat(this.argNames);\r\n    const strictText = '\"use strict\";\\n';\r\n    argNames.push(strictText + script);\r\n    return construct(Function, argNames).apply(undefined, this.argValues);\r\n  }\r\n}\r\n","import Field from '../core/Field';\r\nimport TickEventListener from '../core/TickEventListener';\r\nimport { PlayersDump, FrameDump, ResultDump } from '../core/Dump';\r\nimport ExposedScriptLoader from '../core/ExposedScriptLoader';\r\n\r\nexport interface PlayerInfo {\r\n  name: string;\r\n  color: string;\r\n  source: string;\r\n}\r\n\r\nexport interface InitialParameter {\r\n  isDemo: boolean;\r\n  sources: PlayerInfo[];\r\n}\r\n\r\nexport type Data =\r\n  | NextCommand\r\n  | PlayersCommand\r\n  | PreThinkCommand\r\n  | PostThinkCommand\r\n  | FinishedCommand\r\n  | EndOfGameCommand\r\n  | ErrorCommand;\r\n\r\nexport interface NextCommand {\r\n  command: 'Next';\r\n  issuedId: number;\r\n}\r\n\r\nexport interface PlayersCommand {\r\n  command: 'Players';\r\n  players: PlayersDump;\r\n}\r\n\r\nexport interface PreThinkCommand {\r\n  command: 'PreThink';\r\n  id: number;\r\n}\r\n\r\nexport interface PostThinkCommand {\r\n  command: 'PostThink';\r\n  id: number;\r\n  loadedFrame: number;\r\n}\r\n\r\nexport interface FinishedCommand {\r\n  command: 'Finished';\r\n  result: ResultDump;\r\n}\r\n\r\nexport interface EndOfGameCommand {\r\n  command: 'EndOfGame';\r\n  frames: FrameDump[];\r\n}\r\n\r\nexport interface ErrorCommand {\r\n  command: 'Error';\r\n  error: string;\r\n}\r\n\r\ndeclare function postMessage(message: Data): void;\r\n\r\nlet issueId = 0;\r\nconst issue = () => issueId++;\r\nconst callbacks: { [id: number]: () => void } = {};\r\n\r\nonmessage = ({ data }) => {\r\n  if (data.issuedId !== undefined) {\r\n    callbacks[data.issuedId]();\r\n    delete callbacks[data.issuedId];\r\n    return;\r\n  }\r\n  const initialParameter = data as InitialParameter;\r\n  const isDemo = initialParameter.isDemo as boolean;\r\n  const players = initialParameter.sources as PlayerInfo[];\r\n  const frames: FrameDump[] = [];\r\n  const listener: TickEventListener = {\r\n    waitNextTick: async () => {\r\n      return new Promise<void>(resolve => {\r\n        const issuedId = issue();\r\n        callbacks[issuedId] = resolve;\r\n        postMessage({\r\n          issuedId,\r\n          command: 'Next'\r\n        });\r\n      });\r\n    },\r\n    onPreThink: (sourcerId: number) => {\r\n      postMessage({\r\n        command: 'PreThink',\r\n        id: sourcerId\r\n      });\r\n    },\r\n    onPostThink: (sourcerId: number) => {\r\n      postMessage({\r\n        command: 'PostThink',\r\n        id: sourcerId,\r\n        loadedFrame: frames.length\r\n      });\r\n    },\r\n    onFrame: (fieldDump: FrameDump) => {\r\n      frames.push(fieldDump);\r\n    },\r\n    onFinished: (result: ResultDump) => {\r\n      postMessage({\r\n        result,\r\n        command: 'Finished'\r\n      });\r\n    },\r\n    onEndOfGame: () => {\r\n      postMessage({\r\n        frames,\r\n        command: 'EndOfGame'\r\n      });\r\n    },\r\n    onError: (error: string) => {\r\n      postMessage({\r\n        error,\r\n        command: 'Error'\r\n      });\r\n    }\r\n  };\r\n\r\n  const field = new Field(ExposedScriptLoader, isDemo);\r\n  players.forEach(value => {\r\n    field.registerSourcer(value.source, value.name, value.name, value.color);\r\n  });\r\n\r\n  postMessage({\r\n    command: 'Players',\r\n    players: field.players()\r\n  });\r\n\r\n  setTimeout(async () => {\r\n    await field.compile(listener);\r\n    for (let count = 0; count < 10000 && !field.isFinished; count++) {\r\n      await field.tick(listener);\r\n    }\r\n  }, 0);\r\n};\r\n"],"names":["Actor","field","x","y","Configs","V","_shot","Command","SourcerCommand","sourcer","Controller","actor","frame","FireParam","shotType","MissileParam","bot","LaserParam","power","direction","SourcerController","command","angle","renge","oppositedDirection","normalizedRenge","radar","Utils","isString","value","message","console","_Consts","Consts","Fx","position","speed","length","Shot","owner","type","collided","i","Laser","MissileCommand","missile","normalized","MissileController","missileDirection","Missile","error","attack","superDump","Sourcer","aiSource","account","name","color","scriptLoader","invisiblePower","diff","n","invisibleHand","overheat","linearDamage","powerDamage","param","shot","dump","DEMO_FRAME_LENGTH","Field","scriptLoaderConstructor","isDemo","source","side","listener","think","target","index","fx","survivers","surviver","ownerPosition","actorPosition","currentDistance","f","t","collidedShot","collidedSourcer","count","sumX","players","sourcersDump","shotsDump","fxDump","construct","constructor","args","fun","ExposedScriptLoader","_message","allowLibs","key","script","argNames","issueId","issue","callbacks","data","initialParameter","frames","resolve","issuedId","sourcerId","fieldDump","result"],"mappings":"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"}